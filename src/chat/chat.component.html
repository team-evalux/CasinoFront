<!-- Bouton flottant visible seulement si connectÃ© -->
<button class="chat-toggle" *ngIf="isLogged" (click)="toggle()">ğŸ’¬</button>

<div class="chat-panel" [class.ouvert]="ouvert">
  <div class="chat-header">
    <h3>Chat gÃ©nÃ©ral</h3>
    <button class="close-btn" (click)="toggle()">Ã—</button>
  </div>

  <div class="chat-messages" #scrollZone>
    <div *ngFor="let m of messages" class="chat-message">
      <strong
        class="pseudo"
        [class.disabled]="m.pseudo.trim().toLowerCase() === currentPseudo.trim().toLowerCase()"
        (click)="openTipPopup(m.pseudo)"
      >
        {{ m.pseudo }}
      </strong>
      <span class="contenu">{{ m.contenu }}</span>
      <button *ngIf="isAdmin" class="delete-msg" (click)="supprimerMessage(m.id)">âœ–</button>
    </div>
  </div>

  <div *ngIf="!isLogged" class="chat-warning">
    ğŸ”’ Connecte-toi pour participer au chat !
  </div>

  <div class="chat-input" *ngIf="isLogged">
    <input
      type="text"
      [(ngModel)]="nouveauMessage"
      maxlength="150"
      placeholder="Ã‰cris ton message..."
      (keyup.enter)="envoyer()"
    />
    <button (click)="envoyer()" [disabled]="chargement">Envoyer</button>
  </div>

  <button *ngIf="isAdmin" class="clear-btn" (click)="viderChat()">ğŸ§¹ Vider</button>
</div>

<!-- Popup de tip -->
<div class="tip-popup" *ngIf="popupVisible">
  <div class="tip-box">
    <h4>Tipper {{ targetPseudo }}</h4>
    <p>Ton solde actuel : <strong>{{ currentSolde }}</strong> crÃ©dits</p>

    <input
      type="number"
      [(ngModel)]="tipMontant"
      min="1"
      placeholder="Montant en crÃ©dits"
    />

    <div class="actions">
      <button (click)="envoyerTip()">Envoyer ğŸ’°</button>
      <button class="close" (click)="closeTipPopup()">Annuler</button>
    </div>

    <p class="msg" *ngIf="tipMsg">{{ tipMsg }}</p>
  </div>
</div>
