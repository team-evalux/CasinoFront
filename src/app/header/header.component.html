<header class="en-tete">
  <div class="barre">

    <!-- Gauche : burger (mobile) + actions desktop -->
    <div class="left">
      <button class="burger" (click)="openMenu()" aria-label="Menu">
        <span></span><span></span><span></span>
      </button>

      <div class="actions-desktop">

        <ng-container *ngIf="isLoggedIn(); else desktopLogin">

          <!-- Avatar / Initiale -->
          <div class="avatar-equipped">
            <ng-container *ngIf="equippedAvatar as av; else avatarFallback">
              <img *ngIf="av.imageUrl; else avatarFallback"
                   [src]="av.imageUrl"
                   [alt]="av.nom" />
            </ng-container>
          </div>
          <ng-template #avatarFallback>
            <div class="avatar-equipped avatar-fallback">
              {{ (userObj?.pseudo || userObj?.email || 'U').slice(0,1) }}
            </div>
          </ng-template>

          <a class="bouton"
             [routerLink]="['/shop/avatars']">
            Boutique d'avatars
          </a>

          <a class="bouton"
             [routerLink]="['/inventory/avatars']">
            Mes avatars
          </a>

          <!-- Solde -->
          <app-balance-header></app-balance-header>

          <!-- Logout -->
          <button class="bouton bouton--danger" (click)="logout()">
            Se déconnecter
          </button>
        </ng-container>

        <ng-template #desktopLogin>
          <button class="bouton" [routerLink]="['/register']">S'inscrire</button>
          <button class="bouton bouton--primaire" (click)="ui.openMenu()">Se connecter</button>
          <a class="bouton"
             [routerLink]="['/shop/avatars']">
            Boutique d'avatars
          </a>
        </ng-template>


      </div>

    </div>
    <!-- Centre : logo -->
    <div class="center">
      <a [routerLink]="['/home']" class="logo">
        <img src="assets/images/logo.jpg" alt="EVALUX Casino" />
      </a>
    </div>

    <!-- Droite : bonus -->
    <!-- Droite : bonus (avec libellé & hint cliquable) -->
    <div class="right">
      <div class="bonus-cta">
        <button
          class="gift-btn"
          [class.available]="canClaim"
          [disabled]="!canClaim || bonusLoading"
          (click)="onClickGift()"
          [title]="giftTooltip || (canClaim ? 'Bonus disponible — clique pour le réclamer' : 'Bonus indisponible pour le moment')"
          [attr.aria-label]="giftTooltip || (canClaim ? 'Bonus disponible — cliquez pour le réclamer' : 'Bonus indisponible pour le moment')"
          aria-describedby="bonus-hint"
        >
          <!-- halo animé quand dispo -->
          <span class="ping" *ngIf="canClaim" aria-hidden="true"></span>

          <img src="assets/images/bonus.png" alt="Icône bonus" />

          <!-- badge 'Bonus' collé au bouton -->
          <span class="badge-bonus" aria-hidden="true">Bonus</span>
          <!-- libellé interne (mobile : visible, desktop : masqué) -->
          <span class="badge-bonus-text">Bonus</span>
        </button>


      </div>
    </div>
  </div>


    <!-- Toast -->
  <div *ngIf="bonusMsg" class="toast">{{ bonusMsg }}</div>
</header>
