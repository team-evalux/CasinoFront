<div class="lobby-wrap">
  <header class="lobby-head">
    <h1>Tables Blackjack</h1>

    <div class="create-form">
      <input [(ngModel)]="create.name" maxlength="10" placeholder="Nom de la table (optionnel)">
      <label>Sièges
        <input type="number" [(ngModel)]="create.maxSeats" min="2" max="7" maxlength="1">
      </label>
      <label>Min
        <input type="number"
               [(ngModel)]="create.minBet"
               min="100"
               max="1000000"
               placeholder="Min 100"
               (change)="validateBets()"
               style="width:90px;">
      </label>

      <label>Max
        <input type="number"
               [(ngModel)]="create.maxBet"
               min="1000"
               max="1000000"
               placeholder="Max 1 000 000"
               (change)="validateBets()"
               style="width:110px;">
      </label>

      <select [(ngModel)]="create.visibility">
        <option value="PUBLIC">Publique</option>
        <option value="PRIVATE">Privée</option>
      </select>
      <input *ngIf="create.visibility==='PRIVATE'"
             [(ngModel)]="create.code"
             placeholder="Code d’accès (optionnel)" maxlength="10">
      <button (click)="onCreate()" [disabled]="loading">Créer</button>
    </div>
  </header>

  <div *ngIf="loading">Chargement…</div>
  <div *ngIf="error" class="err">{{ error }}</div>

  <section class="grid">
    <article *ngFor="let t of tables" class="card">
      <h3>{{ t.name ? t.name : ('Table ' + (t.id + '').slice(0,6)) }}</h3>
      <p>
        <small>
          {{ t.maxSeats }} sièges
          • Phase: {{ t.phase }}
          • {{ t.isPrivate ? 'Privée' : 'Publique' }}
          <span *ngIf="t.minBet || t.maxBet"> • Mise: {{ t.minBet || 0 }} - {{ t.maxBet || '∞' }}</span>
        </small>
      </p>
      <div style="display:flex; gap:8px;">
        <button (click)="goTable(t)">Rejoindre</button>
        <!-- Bouton visible seulement pour le créateur -->
        <button *ngIf="t.creatorEmail === (JSON.parse(localStorage.getItem('user')||'{}')?.email || null)"
                (click)="closeTableFromLobby(t.id)"
                [disabled]="t.phase !== 'BETTING'"
                [title]="t.phase !== 'BETTING'
                ? '⏳ Attends la fin de la manche pour fermer la table'
                : 'Fermer la table'">
          ❌ Fermer
        </button>
      </div>
    </article>
  </section>
</div>
