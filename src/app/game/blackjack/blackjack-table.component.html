<!-- en-tête -->
<div style="display:flex; justify-content:space-between; align-items:center; gap:12px;">
  <div>
    <h2 *ngIf="state as s">Table {{ s.name ? (s.name + ' — ') : '' }}{{ s.id }}</h2>
    <div *ngIf="state as s" style="font-size:0.95rem;color:#555">
      <span>Phase: <strong>{{ s.phase }}</strong></span>
      <span *ngIf="remainingSeconds > 0" style="margin-left:12px;">
        • Temps restant: <strong>{{ remainingSeconds }}s</strong>
      </span>
      <span *ngIf="s.currentSeatIndex != null" style="margin-left:12px;">
        • Joueur actif: {{ s.currentSeatIndex }}
      </span>
      <span *ngIf="myTurn()" style="margin-left:12px;color:#0a7;">
        • C'est ton tour !
      </span>
    </div>
  </div>

  <div *ngIf="state?.creatorEmail === meEmail">
    <button (click)="closeTable()">Fermer la table</button>
  </div>
</div>

<!-- message de résultat utilisateur -->
<div *ngIf="state?.phase === 'PAYOUT' && resultMessage" style="margin:12px 0;">
  <div style="padding:10px;border-radius:8px;background:#f3f7ec;border:1px solid #dbe9cf;font-weight:700;">
    {{ resultMessage }}
  </div>
</div>

<!-- indicateur chargement quand pas d'erreur -->
<p *ngIf="!state">Chargement… Attends que la manche en cours soit fini bg</p>

<div *ngIf="state as s">
  <!-- Croupier -->
  <section class="dealer card">
    <h3>Croupier</h3>
    <ng-container *ngIf="state?.phase === 'PLAYING'; else dealerRevealed">
      <div class="cards">
        <img class="card-img" *ngIf="state?.dealer?.cards?.length"
             [src]="'assets/cards/' + cardFileName(state.dealer.cards[0])" alt="carte">
        <!-- dos -->
        <img class="card-img back" src="assets/cards/back.svg" alt="dos de carte">
      </div>
      <small>Total: ??</small>
    </ng-container>
    <ng-template #dealerRevealed>
      <div class="cards">
        <img class="card-img" *ngFor="let c of state?.dealer?.cards"
             [src]="'assets/cards/' + cardFileName(c)" alt="carte">
      </div>
      <small>Total: {{ state?.dealer?.total }}</small>
    </ng-template>
  </section>

  <!-- Sièges -->
  <section class="seats">
    <article class="seat" *ngFor="let seat of state?.seats">
      <header>
        <strong>Siège {{ seat.index }}</strong>
        <small *ngIf="seat.email">{{ seat.email }}</small>
        <small *ngIf="!seat.email">Libre</small>
      </header>

      <div class="cards" *ngIf="seat.hand?.cards?.length">
        <img class="card-img" *ngFor="let c of seat.hand.cards"
             [src]="'assets/cards/' + cardFileName(c)" alt="carte">
      </div>

      <p>Total: {{ seat.hand.total }} • Mise: {{ seat.hand.bet || 0 }}</p>

      <div class="actions" *ngIf="mySeat()?.index === seat.index">
        <button (click)="hit()" [disabled]="!myTurn() || (seat.hand.bet || 0) <= 0">Hit</button>
        <button (click)="stand()" [disabled]="!myTurn() || (seat.hand.bet || 0) <= 0">Stand</button>
        <button (click)="double()" [disabled]="!myTurn() || (seat.hand.bet || 0) <= 0">Double</button>
        <button (click)="surrender()" [disabled]="!myTurn() || (seat.hand.bet || 0) <= 0">Surrender</button>
      </div>

      <button *ngIf="!seat.email && !mySeat()" (click)="sit(seat.index)">S’asseoir ici</button>
    </article>
  </section>

  <!-- zone mise -->
  <section class="betting" *ngIf="s.phase==='BETTING' && mySeat() as me">
    <div style="display:flex;gap:8px;align-items:center;">
      <input type="number"
             [(ngModel)]="betAmount"
             (ngModelChange)="onBetInputChange()"
             [min]="s.minBet || 1"
             [max]="(s.maxBet && s.maxBet>0) ? s.maxBet : null"
             [placeholder]="s.minBet ? ('Mise (' + s.minBet + '–' + (s.maxBet && s.maxBet>0 ? s.maxBet : '∞') + ')') : 'Mise'">
      <button (click)="bet()" [disabled]="!canPlaceBet(s)">Miser</button>
    </div>
    <small *ngIf="s.minBet || s.maxBet" style="display:block;margin-top:6px;color:#555">
      Limites : min = {{ s.minBet || 0 }}
      <span *ngIf="s.maxBet && s.maxBet>0"> • max = {{ s.maxBet }}</span>
    </small>
    <small *ngIf="state?.deadline">Temps restant: {{ remainingSeconds }}s</small>
  </section>
</div>
