<!-- en-tÃªte -->
<div style="display:flex; justify-content:space-between; align-items:center; gap:12px;">
  <div>
    <h2 *ngIf="state as s">Table {{ s.id }}</h2>
    <div *ngIf="state as s" style="font-size:0.95rem;color:#555">
      <span>Phase: <strong>{{ s.phase }}</strong></span>
      <span *ngIf="remainingSeconds > 0" style="margin-left:12px;">
        â€¢ Temps restant: <strong>{{ remainingSeconds }}s</strong>
      </span>
      <span *ngIf="s.currentSeatIndex != null" style="margin-left:12px;">
        â€¢ Joueur actif: {{ s.currentSeatIndex }}
      </span>
      <span *ngIf="myTurn()" style="margin-left:12px;color:#0a7;">
        â€¢ C'est ton tour !
      </span>
    </div>
  </div>

  <div *ngIf="state?.creatorEmail === meEmail">
    <button (click)="closeTable()">Fermer la table</button>
  </div>
</div>

<!-- message de rÃ©sultat utilisateur -->
<div *ngIf="state?.phase === 'PAYOUT' && resultMessage" style="margin:12px 0;">
  <div style="padding:10px;border-radius:8px;background:#f3f7ec;border:1px solid #dbe9cf;font-weight:700;">
    {{ resultMessage }}
  </div>
</div>

<p *ngIf="!state">Chargementâ€¦</p>

<div *ngIf="state as s">
  <!-- Croupier -->
  <section class="dealer card">
    <h3>Croupier</h3>
    <ng-container *ngIf="state?.phase === 'PLAYING'; else dealerRevealed">
      <div class="cards">
        <img class="card-img" *ngIf="state?.dealer?.cards?.length"
             [src]="'assets/cards/' + cardFileName(state.dealer.cards[0])" alt="carte">
        <!-- ðŸ”¹ chemin direct pour le dos -->
        <img class="card-img back" src="assets/cards/back.svg" alt="dos de carte">
      </div>
      <small>Total: ??</small>
    </ng-container>
    <ng-template #dealerRevealed>
      <div class="cards">
        <img class="card-img" *ngFor="let c of state?.dealer?.cards"
             [src]="'assets/cards/' + cardFileName(c)" alt="carte">
      </div>
      <small>Total: {{ state?.dealer?.total }}</small>
    </ng-template>
  </section>

  <!-- SiÃ¨ges -->
  <section class="seats">
    <article class="seat" *ngFor="let seat of state?.seats">
      <header>
        <strong>SiÃ¨ge {{ seat.index }}</strong>
        <small *ngIf="seat.email">{{ seat.email }}</small>
        <small *ngIf="!seat.email">Libre</small>
      </header>

      <div class="cards" *ngIf="seat.hand?.cards?.length">
        <img class="card-img" *ngFor="let c of seat.hand.cards"
             [src]="'assets/cards/' + cardFileName(c)" alt="carte">
      </div>

      <p>Total: {{ seat.hand.total }} â€¢ Mise: {{ seat.hand.bet || 0 }}</p>

      <div class="actions" *ngIf="mySeat()?.index === seat.index">
        <button (click)="hit()" [disabled]="!myTurn() || (seat.hand.bet || 0) <= 0">Hit</button>
        <button (click)="stand()" [disabled]="!myTurn() || (seat.hand.bet || 0) <= 0">Stand</button>
        <button (click)="double()" [disabled]="!myTurn() || (seat.hand.bet || 0) <= 0">Double</button>
        <button (click)="surrender()" [disabled]="!myTurn() || (seat.hand.bet || 0) <= 0">Surrender</button>
      </div>

      <button *ngIf="!seat.email && !mySeat()" (click)="sit(seat.index)">Sâ€™asseoir ici</button>
    </article>
  </section>

  <!-- zone mise -->
  <section class="betting" *ngIf="s.phase==='BETTING' && mySeat() as me">
    <input type="number" [(ngModel)]="betAmount" min="1">
    <button (click)="bet()">Miser</button>
    <small *ngIf="state?.deadline">Temps restant: {{ remainingSeconds }}s</small>
  </section>
</div>
