<!-- en-tÃªte -->
<div style="display:flex; justify-content:space-between; align-items:center; gap:12px;">
  <div>
    <h2 *ngIf="state as s">Table {{ s.id }}</h2>
    <div *ngIf="state as s" style="font-size:0.95rem;color:#555">
      <span>Phase: <strong>{{ s.phase }}</strong></span>
      <span *ngIf="remainingSeconds > 0" style="margin-left:12px;">
        â€¢ Temps restant: <strong>{{ remainingSeconds }}s</strong>
      </span>
      <span *ngIf="s.currentSeatIndex != null" style="margin-left:12px;">
        â€¢ Joueur actif: {{ s.currentSeatIndex }}
      </span>
      <span *ngIf="myTurn()" style="margin-left:12px;color:#0a7;">
        â€¢ C'est ton tour !
      </span>
    </div>
  </div>

  <div *ngIf="state?.creatorEmail === meEmail">
    <button (click)="closeTable()">Fermer la table</button>
  </div>
</div>

<!-- message de rÃ©sultat utilisateur -->
<div *ngIf="state?.phase === 'PAYOUT' && resultMessage" style="margin:12px 0;">
  <div style="padding:10px;border-radius:8px;background:#f3f7ec;border:1px solid #dbe9cf;font-weight:700;">
    {{ resultMessage }}
  </div>
</div>

<p *ngIf="!state">Chargementâ€¦</p>

<div *ngIf="state as s">
  <section class="dealer card">
    <h3>Croupier</h3>

    <!-- pendant PLAYING: on montre 1 carte visible + une face cachÃ©e -->
    <ng-container *ngIf="s.phase === 'PLAYING'; else dealerRevealed">
      <div class="cards">
        <span class="card" *ngIf="s.dealer?.cards?.length">
          {{ asCardText(s.dealer.cards[0].rank, s.dealer.cards[0].suit) }}
        </span>
        <span class="card back">ğŸ‚ </span>
      </div>
      <small>Total: ??</small>
    </ng-container>

    <!-- aprÃ¨s dealer_turn/payout: montrer toute la main et le total -->
    <ng-template #dealerRevealed>
      <div class="cards">
        <span class="card" *ngFor="let c of s.dealer?.cards">{{ asCardText(c.rank, c.suit) }}</span>
      </div>
      <small>Total: {{ s.dealer.total }}</small>
    </ng-template>
  </section>

  <!-- SEATS -->
  <section class="seats">
    <article class="seat" *ngFor="let seat of s.seats">
      <header>
        <strong>SiÃ¨ge {{ seat.index }}</strong>
        <small *ngIf="seat.email">{{ seat.email }}</small>
        <small *ngIf="!seat.email">Libre</small>
      </header>

      <div class="cards" *ngIf="seat.hand?.cards?.length">
        <span class="card" *ngFor="let c of seat.hand.cards">{{ asCardText(c.rank, c.suit) }}</span>
      </div>

      <p *ngIf="seat.hand">Total: {{ seat.hand.total }} â€¢ Mise: {{ seat.hand.bet || 0 }}</p>

      <!-- RÃ©sultat derniÃ¨re manche si dispo -->
      <div class="result" *ngIf="s.lastPayouts as pays">
        <ng-container *ngFor="let p of pays">
          <div *ngIf="p.seat === seat.index">
            <strong *ngIf="p.outcome==='WIN'">âœ… +{{ p.credit - (p.bet) }}</strong>
            <strong *ngIf="p.outcome==='BLACKJACK'">ğŸ–¤ +{{ p.credit - (p.bet) }} (Blackjack)</strong>
            <strong *ngIf="p.outcome==='PUSH'">â– 0 (Push)</strong>
            <strong *ngIf="p.outcome==='LOSE'">âŒ -{{ p.bet }}</strong>
          </div>
        </ng-container>
      </div>

      <!-- actions rapides (Ã  adapter selon ton guard isMySeat etc.) -->
      <div class="actions" *ngIf="mySeat()?.index === seat.index">
        <button (click)="hit()"    [disabled]="!myTurn()">Hit</button>
        <button (click)="stand()"  [disabled]="!myTurn()">Stand</button>
        <button (click)="double()" [disabled]="!myTurn()">Double</button>
        <button (click)="surrender()" [disabled]="!myTurn()">Surrender</button>
      </div>

      <!-- n'affiche le bouton que si le siÃ¨ge est libre ET que l'utilisateur n'est pas dÃ©jÃ  assis -->
      <button *ngIf="!seat.email && !mySeat()" (click)="sit(seat.index)">Sâ€™asseoir ici</button>
    </article>
  </section>

  <!-- zone mise -->
  <section class="betting" *ngIf="s.phase==='BETTING' && mySeat() as me">
    <input type="number" [(ngModel)]="betAmount" min="1">
    <button (click)="bet()">Miser</button>
    <small *ngIf="state?.deadline">Temps restant: {{ remainingSeconds }}s</small>
  </section>
</div>
