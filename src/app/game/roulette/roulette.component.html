<!-- src/app/games/roulette/roulette.component.html -->
<div class="conteneur section-jeu roulette-layout">
  <!-- ContrÃ´les -->
  <div class="bet-controls">
    <h3 style="margin:0 0 10px 0;font-family:'Playfair Display',serif;color:#f1f5f9;">Parier</h3>

    <label class="libelle">Type de pari</label>
    <select [(ngModel)]="betType" class="champ mb-12" [disabled]="!isLoggedIn || enCours">
      <option value="straight">NumÃ©ro</option>
      <option value="color">Couleur</option>
      <option value="parity">Pair / Impair</option>
      <option value="range">1-18 / 19-36</option>
      <option value="dozen">Douzaine</option>
    </select>

    <div class="mb-12">
      <label class="libelle">Valeur</label>
      <ng-container [ngSwitch]="betType">
        <input *ngSwitchCase="'straight'" class="champ" type="number" min="0" max="36" [(ngModel)]="betValue" [disabled]="!isLoggedIn || enCours"/>
        <select *ngSwitchCase="'color'" class="champ" [(ngModel)]="betValue" [disabled]="!isLoggedIn || enCours">
          <option value="red">Rouge</option><option value="black">Noir</option>
        </select>
        <select *ngSwitchCase="'parity'" class="champ" [(ngModel)]="betValue" [disabled]="!isLoggedIn || enCours">
          <option value="even">Pair</option><option value="odd">Impair</option>
        </select>
        <select *ngSwitchCase="'range'" class="champ" [(ngModel)]="betValue" [disabled]="!isLoggedIn || enCours">
          <option value="low">1-18</option><option value="high">19-36</option>
        </select>
        <select *ngSwitchCase="'dozen'" class="champ" [(ngModel)]="betValue" [disabled]="!isLoggedIn || enCours">
          <option value="1">1 (1-12)</option><option value="2">2 (13-24)</option><option value="3">3 (25-36)</option>
        </select>
      </ng-container>
    </div>

    <div class="mb-12">
      <label class="libelle">Mise</label>
      <div style="display:flex; align-items:center; gap:6px;">
        <input class="champ" type="number"
               [(ngModel)]="montant"
               [attr.min]="minBet"
               [attr.max]="currentBalance || 1000000"
               [disabled]="!isLoggedIn || enCours"/>
        <button type="button"
                (click)="montant = Math.min((montant || 0) * 2, currentBalance || 1000000)"
                [disabled]="!isLoggedIn || enCours">
          Ã—2
        </button>
        <button type="button"
                (click)="montant = Math.max(Math.floor((montant || 0) / 2), minBet)"
                [disabled]="!isLoggedIn || enCours">
          /2
        </button>
      </div>
      <small class="sous-texte">Mise minimale : <strong>{{ minBet }}</strong> â€¢ Solde : <strong>{{ currentBalance ?? 'â€”' }}</strong></small>
    </div>

    <div class="boutons">
      <input type="number" min="1" placeholder="Nb de tours"
             [(ngModel)]="autoSpinCount" [disabled]="autoSpinActive">
      <button (click)="jouer()" [disabled]="!isLoggedIn || enCours || !montant || montant < minBet" class="bouton bouton--or">Placer le pari</button>
      <button (click)="startAutoSpin(autoSpinCount!)" [disabled]="!isLoggedIn || autoSpinActive || montant<minBet || !autoSpinCount " class="bouton">Auto (N)</button>
      <button (click)="startAutoSpin()" [disabled]="!isLoggedIn || autoSpinActive || montant<minBet" class="bouton">Auto âˆž</button>
      <button (click)="stopAutoSpin()" [disabled]="!isLoggedIn || !autoSpinActive" class="bouton bouton--secondaire">Stop</button>
      <a [routerLink]="['/home']" class="bouton">Retour</a>
    </div>

    <div class="panneau mt-12">
      <p>Solde : <strong>{{ currentBalance ?? 'â€”' }}</strong></p>
      <div *ngIf="lastResult" class="d-flex aic gap-12 mt-8">
        <div [style.background]="colorFor(lastResult.color)" class="pastille" style="width:56px;height:56px;font-size:20px;">
          {{ lastResult.number }}
        </div>
        <div>
          <div style="font-weight:700">
            {{ lastResult.number }}
            <small style="text-transform:capitalize;margin-left:8px;">{{ lastResult.color }}</small>
          </div>

          <!-- âœ… affiche en net -->
          <ng-container [ngSwitch]="true">
            <div *ngSwitchCase="netGainOf(lastResult) > 0" style="color:#34d399;margin-top:6px;">
              GagnÃ© <strong>{{ netLabelOf(lastResult) }}</strong>
            </div>
            <div *ngSwitchCase="netGainOf(lastResult) === 0" style="color:#eab308;margin-top:6px;">
              Mise rendue â€¢ <strong>0</strong>
            </div>
            <div *ngSwitchDefault style="color:#f87171;margin-top:6px;">
              Perdu <strong>{{ netLabelOf(lastResult) }}</strong>
            </div>
          </ng-container>

          <div class="sous-texte mt-8">
            Multiplicateur : <strong>{{ resultMultiplier(lastResult) ?? 'â€”' }}</strong>
          </div>
        </div>
      </div>

      <div *ngIf="!lastResult" class="sous-texte">Aucun spin rÃ©cent</div>
      <p *ngIf="error" class="mt-8" style="color:#ff9b9b">{{ error }}</p>
    </div>

    <app-game-history-list [game]="'roulette'" [limit]="5" class="mt-12"></app-game-history-list>
  </div>

  <!-- Zone roue + table -->
  <div class="roulette-main">
    <h2 class="titre-page">Roulette</h2>

    <div class="wheel-stage" style="position:relative;">
      <div class="wheel-wrapper" [style.width.px]="wheelSizePx" [style.height.px]="wheelSizePx">
        <div class="wheel-numbers-container">
          <div #wheelEl class="wheel-numbers" [class.spinning]="wheelSpinning" [style.transition]="wheelTransition" [style.transform]="'rotate(' + wheelRotation + 'deg)'">
            <div *ngFor="let n of wheelNumbers; let i = index" class="wheel-number" [style.transform]="'rotate(' + (i * sectorAngle) + 'deg) translateY(-' + rimRadiusPx + 'px)'">
              <span class="num-label" [class.red]="isRed(n)" [class.green]="n === 0" [class.black]="!isRed(n) && n !== 0">{{ n }}</span>
            </div>
          </div>
        </div>
        <div class="pointer">â–¼</div>
      </div>

      <!-- ðŸ”’ Overlay dâ€™aperÃ§u -->
      <div *ngIf="!isLoggedIn" class="lock-overlay">
        <div class="lock">ðŸ”’</div>
        <div>Connecte-toi pour faire tourner la roue</div>
        <a routerLink="/login" class="cta">Se connecter</a>
      </div>
    </div>

    <!-- Table des mises -->
    <div class="bet-table">
      <div class="table-top">
        <div class="zero-col">
          <button class="cell zero" (click)="betType='straight'; betValue='0'; choisirNumero(0)" [disabled]="!isLoggedIn || enCours">0</button>
        </div>
        <div class="rows">
          <div class="row" *ngFor="let row of tableRows">
            <button *ngFor="let n of row"
                    class="cell num-btn"
                    [class.red]="isRed(n)"
                    [class.black]="!isRed(n) && n !== 0"
                    [class.selected]="selectedNumber === n"
                    (click)="choisirNumero(n); betType='straight'; betValue = ''+n"
                    [disabled]="!isLoggedIn || enCours">
              {{ n }}
            </button>
          </div>
        </div>
      </div>
      <div class="dozens">
        <button class="cell dozen" (click)="betType='dozen'; betValue='1'" [disabled]="!isLoggedIn || enCours">1 to 12</button>
        <button class="cell dozen" (click)="betType='dozen'; betValue='2'" [disabled]="!isLoggedIn || enCours">13 to 24</button>
        <button class="cell dozen" (click)="betType='dozen'; betValue='3'" [disabled]="!isLoggedIn || enCours">25 to 36</button>
      </div>
      <div class="bottom-row">
        <button class="cell bottom" (click)="betType='range'; betValue='low'" [disabled]="!isLoggedIn || enCours">1 to 18</button>
        <button class="cell bottom" (click)="betType='parity'; betValue='even'" [disabled]="!isLoggedIn || enCours">Even</button>
        <button class="cell bottom red-toggle" (click)="betType='color'; betValue='red'" [disabled]="!isLoggedIn || enCours">Red</button>
        <button class="cell bottom black-toggle" (click)="betType='color'; betValue='black'" [disabled]="!isLoggedIn || enCours">Black</button>
        <button class="cell bottom" (click)="betType='parity'; betValue='odd'" [disabled]="!isLoggedIn || enCours">Odd</button>
        <button class="cell bottom" (click)="betType='range'; betValue='high'" [disabled]="!isLoggedIn || enCours">19 to 36</button>
      </div>
    </div>
  </div>
</div>
