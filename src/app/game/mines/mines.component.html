<div class="conteneur">
  <div class="slot-wrap">
    <h2 class="titre-page">ğŸ’ Mines (5Ã—5) â€” rÃ©vÃ©lation progressive</h2>

    <p class="sous-texte">
      <ng-container *ngIf="!isLoggedIn">ğŸŒ Mode invitÃ© â€” crÃ©dits fictifs â€¢ </ng-container>
      Solde : <strong>{{ currentBalance ?? 'â€”' }}</strong> â€¢
      Mise minimale : <strong>{{ minBet }}</strong>
    </p>

    <div class="d-flex gap-12 mb-12 aic" style="flex-wrap:wrap;">

      <!-- Mise -->
      <div class="bloc">
        <label class="libelle">Mise</label>
        <div class="ligne">
          <input class="champ"
                 type="number"
                 [ngModel]="mise"
                 (ngModelChange)="onMiseChange($event)"
                 (keydown)="blockMiseKeys($event)"
                 [disabled]="!!sessionId"
                 [attr.min]="minBet"
                 [attr.max]="getMaxMise() || 0" />
          <button (click)="onMiseChange(Math.floor((mise||0)/2))"
                  [disabled]="!!sessionId">/2</button>
          <button (click)="onMiseChange((mise||0)*2)"
                  [disabled]="!!sessionId">Ã—2</button>
        </div>
        <small class="sous-texte">
          Mise min : <strong>{{ minBet }}</strong>
          â€¢ Mise max : <strong>{{ getMaxMise() || 0 }}</strong>
        </small>
      </div>

      <!-- Mines -->
      <div class="bloc">
        <label class="libelle">Mines</label>
        <div class="ligne">
          <input class="champ"
                 type="number"
                 [ngModel]="mines"
                 (ngModelChange)="onMinesChange($event)"
                 (keydown)="blockMinesKeys($event)"
                 [disabled]="!!sessionId"
                 min="1"
                 max="24" />
          <button (click)="onMinesChange(mines-1)"
                  [disabled]="!!sessionId">-</button>
          <button (click)="onMinesChange(mines+1)"
                  [disabled]="!!sessionId">+</button>
        </div>
        <small class="sous-texte">
          Diamants max possibles : <strong>{{ 25 - (mines||0) }}</strong>
        </small>
      </div>

      <!-- Boutons -->
      <button class="bouton bouton--primaire" style="width:140px;"
              (click)="start()"
              [disabled]="!canStart()">
        {{ sessionId ? 'Partie en cours' : 'DÃ©marrer' }}
      </button>

      <button class="bouton bouton--secondaire" style="width:140px;"
              (click)="cashout()"
              [disabled]="!canCashout()">
        Encaisser {{ safeCount>0 ? ('(Ã—'+(table[safeCount]||0)+')') : '' }}
      </button>

      <a [routerLink]="['/home']" class="bouton">Retour</a>
    </div>

    <p *ngIf="sessionId && !finished" class="sous-texte">
      Diamants trouvÃ©s : <strong>{{ safeCount }}</strong> â€¢
      Prochain palier : <strong>Ã—{{ nextMultiplier || 0 }}</strong>
    </p>
    <p *ngIf="error" class="erreur">{{ error }}</p>

    <!-- Grille -->
    <div class="grid" [class.disabled]="enCours">
      <button type="button"
              *ngFor="let idx of CELLS"
              class="cellule"
              [class.revelee]="revealed.has(idx)"
              [class.bomb]="revealed.has(idx) && bombs.has(idx)"
              (click)="canPick() && clickCell(idx)">
        <ng-container *ngIf="revealed.has(idx); else hidden">
          <span *ngIf="bombs.has(idx)">ğŸ’£</span>
          <span *ngIf="!bombs.has(idx)">ğŸ’</span>
        </ng-container>
        <ng-template #hidden> </ng-template>
      </button>
    </div>

    <!-- RÃ©sumÃ© simple -->
    <div *ngIf="finished" class="panneau mt-12">
      <p class="mt-8">Partie terminÃ©e.</p>
      <p class="sous-texte">Relance avec Â« DÃ©marrer Â».</p>
    </div>

    <!-- ====== RÃ¨gles du jeu : Mines ====== -->
    <div class="panneau mt-12 regles-jeu">
      <h3 class="titre-regles">ğŸ¯ RÃ¨gles du jeu â€” Mines</h3>
      <ul class="liste-regles">
        <li>La grille contient <strong>25 cases</strong>. Tu choisis le nombre de <strong>mines</strong> entre 1 et 24.</li>
        <li>Plus il y a de mines, plus les <strong>multiplicateurs</strong> augmentent, mais le risque aussi.</li>
        <li>Tu sÃ©lectionnes ta <strong>mise</strong>, puis tu cliques sur <strong>Â« DÃ©marrer Â»</strong> pour lancer la partie.</li>
        <li>Ã€ chaque clic sur une case non rÃ©vÃ©lÃ©e :
          <br>â€¢ Si tu trouves un ğŸ’, ton <strong>multiplicateur actuel augmente</strong> et tu peux continuer.
          <br>â€¢ Si tu tombes sur une ğŸ’£, tu <strong>perds toute ta mise</strong> et la partie se termine.
        </li>
        <li>Ã€ tout moment aprÃ¨s avoir trouvÃ© au moins un ğŸ’, tu peux cliquer sur <strong>Â« Encaisser Â»</strong> :
          tu rÃ©cupÃ¨res <strong>mise Ã— multiplicateur</strong> en <strong>crÃ©dits rÃ©els</strong>.</li>
        <li>La partie se termine automatiquement si tu as dÃ©couvert toutes les cases sÃ»res (tous les diamants possibles).</li>
      </ul>

      <div class="note-regle">
        ğŸ’¡ Exemple : tu mises <strong>100 crÃ©dits</strong> avec <strong>3 mines</strong>.
        AprÃ¨s quelques clics sÃ©curisÃ©s, ton multiplicateur atteint <strong>Ã—2.40</strong>.
        Si tu encaisses Ã  ce moment-lÃ , tu remportes <strong>240 crÃ©dits</strong>.
        Si tu cliques une fois de trop et touches une ğŸ’£, tu perds les 100 crÃ©dits misÃ©s.
      </div>
    </div>

    <!-- Historique -->
    <div class="panneau mt-12">
      <app-game-history-list [game]="'mines'" [limit]="5"></app-game-history-list>
    </div>
  </div>
</div>
