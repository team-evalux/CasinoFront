<div class="conteneur section-jeu">
  <div class="panneau">
    <h2 class="titre-page">Pile ou Face</h2>
    <p class="sous-texte">Mise minimale : <strong>{{ minBet }}</strong> crÃ©dits.</p>

    <div class="coin-stage" style="position:relative;">
      <!-- Animation / rendu -->
      <div class="coin-anim"
           [class.en-attente]="enCours && !resolutionEnCours"
           [class.en-resolution]="resolutionEnCours"
           [style.--target-rot]="targetRot"
           [style.--rot-dur]="rotateDuration"
           [style.--base-rot]="baseRotDeg + 'deg'">
        <div class="coin" [class.static]="!enCours && !resolutionEnCours">
          <div class="face front">PILE</div>
          <div class="face back">FACE</div>
        </div>
        <div class="shadow"></div>
      </div>

      <!-- ğŸ”’ Overlay dâ€™aperÃ§u quand pas connectÃ© -->
      <div *ngIf="!isLoggedIn" class="lock-overlay">
        <div class="lock">ğŸ”’</div>
        <div>Connecte-toi pour jouer</div>
        <a routerLink="/login" class="cta">Se connecter</a>
      </div>
    </div>

    <div class="mb-12">
      <label class="libelle">Mise (crÃ©dits)</label>
      <small *ngIf="currentBalance !== null && mise > currentBalance" style="display:block;color:#ff9b9b;">
        La mise ne peut pas dÃ©passer votre solde ({{ currentBalance }} crÃ©dits).
      </small>

      <div style="display:flex; align-items:center; gap:6px;">
        <input class="champ" type="number" [(ngModel)]="mise" [attr.min]="minBet"  [attr.max]="currentBalance ?? maxBet" [disabled]="enCours || !isLoggedIn">
        <button
          type="button"
          (click)="mise = Math.min(mise * 2, currentBalance ?? maxBet)"
          [disabled]="enCours || !isLoggedIn">
          Ã—2
        </button>
        <button
          type="button"
          (click)="mise = Math.max(Math.floor(mise / 2), minBet)"
          [disabled]="enCours || !isLoggedIn">
          /2
        </button>

      </div>
      <small class="sous-texte">Solde : <strong>{{ currentBalance ?? 'â€”' }}</strong></small>
      <small *ngIf="mise && mise < minBet" style="display:block;color:#ff9b9b;">La mise doit Ãªtre â‰¥ {{ minBet }}.</small>
    </div>

    <div class="mb-12">
      <label class="libelle">Choisis</label>
      <div class="d-flex gap-12">
        <label><input type="radio" name="choix" [(ngModel)]="choix" value="pile" [disabled]="enCours || !isLoggedIn"> Pile</label>
        <label><input type="radio" name="choix" [(ngModel)]="choix" value="face" [disabled]="enCours || !isLoggedIn"> Face</label>
      </div>
    </div>

    <div class="boutons">
      <button (click)="jouer()"
              [disabled]="!isLoggedIn || enCours || !mise || mise < minBet"
              class="bouton bouton--primaire">
        Jouer
      </button>
      <a [routerLink]="['/home']" class="bouton">Retour</a>
    </div>

    <div *ngIf="message || error" class="panneau mt-12">
      <div *ngIf="lastResult">
        <p><strong>RÃ©sultat :</strong> {{ lastResult?.outcome | uppercase }}</p>

        <!-- Affiche le net -->
        <ng-container [ngSwitch]="true">
          <p *ngSwitchCase="netGain > 0" style="color:#34d399">
            Tu as gagnÃ© ! {{ netLabel }} crÃ©dits.
          </p>
          <p *ngSwitchCase="netGain === 0" style="color:#eab308">
            Tu rÃ©cupÃ¨res ta mise. 0 crÃ©dit net.
          </p>
          <p *ngSwitchDefault style="color:#f87171">
            Tu as perdu. {{ netLabel }} crÃ©dits.
          </p>
        </ng-container>

        <p>Solde : <strong>{{ lastResult?.solde }}</strong></p>
      </div>

      <p *ngIf="error" style="color:#ff9b9b">{{ error }}</p>
    </div>

    <div class="mt-12 sous-texte">
      <small>Gain net = (2Ã—mise) âˆ’ mise quand tu gagnes.</small>
    </div>
  </div>

  <!-- ====== RÃ¨gles du jeu : Pile ou Face ====== -->
  <div class="panneau mt-12 regles-jeu">
    <h3 class="titre-regles">ğŸ¯ RÃ¨gles du jeu â€” Pile ou Face</h3>
    <ul class="liste-regles">
      <li>
        Tu mises un certain nombre de <strong>crÃ©dits</strong> (minimum {{ minBet }}).
      </li>
      <li>
        Choisis entre <strong>Pile</strong> ou <strong>Face</strong>.
      </li>
      <li>
        Si le rÃ©sultat correspond Ã  ton choix, tu gagnes <strong>2Ã— ta mise</strong>.
      </li>
      <li>
        Sinon, tu perds ta mise.
      </li>
      <li>
        Le rÃ©sultat est entiÃ¨rement <strong>alÃ©atoire et Ã©quitable</strong> (50 % de chances de gagner).
      </li>
    </ul>

    <div class="note-regle">
      ğŸ’¡ Exemple : tu mises <strong>200 crÃ©dits</strong> sur <strong>Pile</strong>.
      Si tu gagnes, tu remportes <strong>400 crÃ©dits</strong> (soit un gain net de +200 crÃ©dits).
    </div>
  </div>


  <div class="panneau mt-12">
    <app-game-history-list [game]="'coinflip'" [limit]="5"></app-game-history-list>
  </div>
</div>
